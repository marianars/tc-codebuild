version: 0.2

phases:
  install:
    runtime-versions:
      terraform: 0.13 
    commands:
      # Instalar cualquier dependencia requerida aquÃ­
  pre_build:
    commands:
      echo "Setting AWS credentials..."
      echo $AWS_ACCESS_KEY_ID > ~/.aws/credentials
      echo $AWS_SECRET_ACCESS_KEY >> ~/.aws/credentials
      echo $AWS_DEFAULT_REGION >> ~/.aws/config
      echo "Downloading Terraform modules..."
      cd $CODEBUILD_SRC_DIR/codeterraform/
      terraform init -input=false -backend-config="bucket=new-tc-terraform-state"

  build:
    commands:
      echo "Applying Terraform changes..."
      terraform plan

  post_build:
    commands:
      echo "Build complete"


